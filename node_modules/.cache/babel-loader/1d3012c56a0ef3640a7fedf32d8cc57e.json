{"ast":null,"code":"import _defineProperty from \"D:\\\\Downloads\\\\Test HTML\\\\testgenerator\\\\Test_app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/defineProperty\";\nimport _toConsumableArray from \"D:\\\\Downloads\\\\Test HTML\\\\testgenerator\\\\Test_app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/toConsumableArray\";\nimport _objectSpread from \"D:\\\\Downloads\\\\Test HTML\\\\testgenerator\\\\Test_app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread\";\nimport _regeneratorRuntime from \"D:\\\\Downloads\\\\Test HTML\\\\testgenerator\\\\Test_app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";\nimport _asyncToGenerator from \"D:\\\\Downloads\\\\Test HTML\\\\testgenerator\\\\Test_app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"D:\\\\Downloads\\\\Test HTML\\\\testgenerator\\\\Test_app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";\nimport _asyncIterator from \"D:\\\\Downloads\\\\Test HTML\\\\testgenerator\\\\Test_app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncIterator\";\n\nvar _this = this,\n    _jsxFileName = \"D:\\\\Downloads\\\\Test HTML\\\\testgenerator\\\\Test_app\\\\src\\\\containers\\\\TicTacToe\\\\GameListPage\\\\children\\\\List\\\\list.component.js\";\n\nfunction _createForOfIteratorHelper(o, allowArrayLike) { var it; if (typeof Symbol === \"undefined\" || o[Symbol.iterator] == null) { if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e) { throw _e; }, f: F }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = o[Symbol.iterator](); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e2) { didErr = true; err = _e2; }, f: function f() { try { if (!normalCompletion && it.return != null) it.return(); } finally { if (didErr) throw err; } } }; }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nimport React, { useState, useEffect, useCallback } from 'react';\nimport { useLiveUpdate, NotificationTypes, shexUtil } from '@inrupt/solid-react-components';\nimport { useTranslation } from 'react-i18next';\nimport ldflex from '@solid/query-ldflex';\nimport { namedNode } from '@rdfjs/data-model';\nimport { Loader, Select } from \"../../../../../components/Utils\";\nimport tictactoeShape from \"../../../../../contexts/tictactoe-shape.json\";\nimport { ldflexHelper, errorToaster, storageHelper, notification as helperNotification } from \"../../../../../utils\";\nimport { GameStatusList, GameStatus, KnownInboxes } from \"../../../../../constants\";\nimport { LDP } from \"../../../../../vocabs\";\nimport { Wrapper, ListWrapper, GameListContainers, GameListHeader } from \"./list.style\";\nimport GameItem from \"./children\";\nvar oldTimestamp;\nvar appPath;\n\n/**\n * Loads, filters, and displays the list of available games for the current user\n *\n * @param {String} title - Title of the list to display\n * @param {Array} games - A list of all of the games available to the user\n * @param {String} webId - WebID URL of the current user\n * @param {Function} deleteGame - A reference to the delete game function\n */\nvar GameList = function GameList(_ref) {\n  var title = _ref.title,\n      games = _ref.games,\n      webId = _ref.webId,\n      deleteGame = _ref.deleteGame;\n\n  var _useTranslation = useTranslation(),\n      t = _useTranslation.t;\n\n  var _useState = useState(games),\n      _useState2 = _slicedToArray(_useState, 2),\n      filteredGames = _useState2[0],\n      setFilteredGames = _useState2[1];\n\n  var _useState3 = useState('All'),\n      _useState4 = _slicedToArray(_useState3, 2),\n      selectedFilter = _useState4[0],\n      setSelectedFilter = _useState4[1];\n  /**\n   * Set the visible game list depending on what filter the user has selected\n   * @param event\n   */\n\n\n  var filterGameList = function filterGameList(event) {\n    var filter = event.target.value;\n\n    if (filter === GameStatus.ALL) {\n      setFilteredGames(games);\n    } else {\n      var filteredList = games.filter(function (game) {\n        return game.status === filter;\n      });\n      setFilteredGames(filteredList);\n    }\n\n    setSelectedFilter(filter);\n  };\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 54,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(GameListHeader, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 55,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"h2\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 56,\n      columnNumber: 9\n    }\n  }, title), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"input-wrap\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 57,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"label\", {\n    htmlFor: \"selected-filter\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 58,\n      columnNumber: 11\n    }\n  }, t('game.status'), /*#__PURE__*/React.createElement(Select, {\n    name: \"selected-filter\",\n    id: \"selected-filter\",\n    options: GameStatusList,\n    defaultValue: selectedFilter,\n    onChange: filterGameList,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 60,\n      columnNumber: 13\n    }\n  })))), filteredGames.length > 0 ? /*#__PURE__*/React.createElement(ListWrapper, {\n    className: \"ids-container__four-column grid\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 71,\n      columnNumber: 9\n    }\n  }, filteredGames.map(function (game) {\n    return /*#__PURE__*/React.createElement(GameItem, Object.assign({\n      game: game\n    }, {\n      key: game.url,\n      webId: webId,\n      deleteGame: deleteGame,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 73,\n        columnNumber: 13\n      }\n    }));\n  })) : /*#__PURE__*/React.createElement(\"span\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 77,\n      columnNumber: 9\n    }\n  }, t('game.nogames')));\n};\n\nvar List = function List(_ref2) {\n  var webId = _ref2.webId,\n      gamePath = _ref2.gamePath,\n      sendNotification = _ref2.sendNotification;\n\n  var _useState5 = useState([]),\n      _useState6 = _slicedToArray(_useState5, 2),\n      list = _useState6[0],\n      setList = _useState6[1];\n\n  var _useState7 = useState(false),\n      _useState8 = _slicedToArray(_useState7, 2),\n      isLoading = _useState8[0],\n      setIsLoading = _useState8[1];\n\n  var _useTranslation2 = useTranslation(),\n      t = _useTranslation2.t;\n\n  var updates = useLiveUpdate();\n  var timestamp = updates.timestamp;\n  /**\n   * Gets the entire predicate named Node based on a field property from the shape\n   * @param {String} field Field to get the predicate for\n   * @returns {String} Predicate for a field name\n   */\n\n  var getPredicate = function getPredicate(field) {\n    var prefix = tictactoeShape['@context'][field.prefix];\n    return \"\".concat(prefix).concat(field.predicate);\n  };\n  /**\n   * Deletes a game from a contains predicate in a specific url\n   * @param {String} gameUrl Game to delete\n   * @param {String} documentUrl URL of the document with a contains predicate\n   */\n\n\n  var deleteGameFromContains = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(gameUrl, documentUrl) {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return ldflex[documentUrl]['schema:hasPart'].delete(namedNode(gameUrl));\n\n            case 2:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function deleteGameFromContains(_x, _x2) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n  /**\n   * Deletes a game as invitee, sets the game status to Resigned and sends a notification to the owner\n   * @param {Object} game Game to be deleted\n   */\n\n\n  var resignedGame = /*#__PURE__*/function () {\n    var _ref5 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(_ref4) {\n      var url, documentUrl, status, actor, statusPredicate, licenseUrl, gameSettings, GLOBAL, GAME, inboxes, to;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              url = _ref4.url, documentUrl = _ref4.documentUrl, status = _ref4.status, actor = _ref4.actor;\n\n              if (!(status !== GameStatus.FINISHED)) {\n                _context2.next = 18;\n                break;\n              }\n\n              statusPredicate = 'http://data.totl.net/game/status';\n              licenseUrl = 'https://creativecommons.org/licenses/by-sa/4.0/'; // Change status to resigned\n\n              _context2.next = 6;\n              return ldflex[url][statusPredicate].replace(status, GameStatus.RESIGNED);\n\n            case 6:\n              if (appPath) {\n                _context2.next = 10;\n                break;\n              }\n\n              _context2.next = 9;\n              return storageHelper.getAppStorage(actor.webId);\n\n            case 9:\n              appPath = _context2.sent;\n\n            case 10:\n              // Send notification\n              gameSettings = \"\".concat(appPath, \"settings.ttl\");\n              GLOBAL = KnownInboxes.GLOBAL, GAME = KnownInboxes.GAME;\n              _context2.next = 14;\n              return helperNotification.findUserInboxes([{\n                path: actor.webId,\n                name: GLOBAL\n              }, {\n                path: gameSettings,\n                name: GAME\n              }]);\n\n            case 14:\n              inboxes = _context2.sent;\n              to = helperNotification.getDefaultInbox(inboxes, GAME, GLOBAL);\n              _context2.next = 18;\n              return sendNotification({\n                title: 'Tictactoe resignation',\n                summary: 'has resigned a game of TicTacToe',\n                actor: webId,\n                object: url\n              }, to.path, NotificationTypes.LEAVE, licenseUrl);\n\n            case 18:\n              _context2.next = 20;\n              return deleteGameFromContains(url, documentUrl);\n\n            case 20:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function resignedGame(_x3) {\n      return _ref5.apply(this, arguments);\n    };\n  }();\n  /**\n   * Deletes a game based on it's url. Checks for a deleted flag\n   * to check if it needs to be deleted from a contains predicate\n   * @param {Object} game Game to be deleted\n   */\n\n\n  var deleteGame = /*#__PURE__*/function () {\n    var _ref6 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(game) {\n      var url, deleted, documentUrl, opponent, newGames;\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              url = game.url, deleted = game.deleted, documentUrl = game.documentUrl, opponent = game.opponent;\n\n              if (!deleted) {\n                _context3.next = 6;\n                break;\n              }\n\n              _context3.next = 4;\n              return deleteGameFromContains(url, documentUrl);\n\n            case 4:\n              _context3.next = 13;\n              break;\n\n            case 6:\n              if (!(opponent.webId === webId)) {\n                _context3.next = 11;\n                break;\n              }\n\n              _context3.next = 9;\n              return resignedGame(game);\n\n            case 9:\n              _context3.next = 13;\n              break;\n\n            case 11:\n              _context3.next = 13;\n              return ldflexHelper.deleteFile(url);\n\n            case 13:\n              newGames = list.filter(function (gameItem) {\n                return gameItem.url !== url;\n              });\n              setList(newGames);\n\n            case 15:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n\n    return function deleteGame(_x4) {\n      return _ref6.apply(this, arguments);\n    };\n  }();\n  /**\n   * Get basic info for the opponent player (name and image url)\n   * @param {String} webId WebId of the player to look the Info for\n   * @returns {Object} An object with the basic information of the player\n   */\n\n\n  var getPlayerInfo = useCallback( /*#__PURE__*/function () {\n    var _ref7 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(webId) {\n      var name, nameValue, imageUrl, image;\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              _context4.prev = 0;\n              _context4.next = 3;\n              return ldflex[webId]['vcard:fn'];\n\n            case 3:\n              name = _context4.sent;\n              nameValue = name && name.value.trim().length > 0 ? name.value : webId.toString();\n              _context4.next = 7;\n              return ldflex[webId]['vcard:hasPhoto'];\n\n            case 7:\n              imageUrl = _context4.sent;\n              image = imageUrl ? imageUrl.value : 'img/people.svg';\n              return _context4.abrupt(\"return\", {\n                name: nameValue,\n                image: image,\n                webId: webId\n              });\n\n            case 12:\n              _context4.prev = 12;\n              _context4.t0 = _context4[\"catch\"](0);\n              return _context4.abrupt(\"return\", {\n                name: webId,\n                image: 'img/people.svg',\n                webId: webId\n              });\n\n            case 15:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4, null, [[0, 12]]);\n    }));\n\n    return function (_x5) {\n      return _ref7.apply(this, arguments);\n    };\n  }());\n  /**\n   * Fetches all games from a url\n   * @param {String} url URL for the container to get the games from\n   */\n\n  var getGames = useCallback( /*#__PURE__*/function () {\n    var _ref8 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5(url) {\n      var gameItemPredicate, document, gameList, type, typeValue, gameUrls, _iteratorNormalCompletion, _didIteratorError, _iteratorError, _iterator, _step, _value, item, value, gameShapeUrl, games, _iteratorNormalCompletion2, _didIteratorError2, _iteratorError2, _iterator2, _step2, _value2, game, gameData, _iterator3, _step3, _loop, opponent, actor;\n\n      return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              _context5.prev = 0;\n              _context5.next = 3;\n              return ldflexHelper.fetchLdflexDocument(url);\n\n            case 3:\n              document = _context5.sent;\n              gameList = [];\n\n              if (document) {\n                _context5.next = 7;\n                break;\n              }\n\n              return _context5.abrupt(\"return\", gameList);\n\n            case 7:\n              _context5.next = 9;\n              return document['rdf:type'];\n\n            case 9:\n              type = _context5.sent;\n              typeValue = type ? type.value : undefined;\n              /**\n               * If the document is a container, then we want to loop over the ldp:contains property of the container\n               * If it is not a container, we are using schema:hasPart so we don't confuse it with a container\n               * schema:hasPart is used for externally linked games in other people's pods\n               */\n\n              if (typeValue === LDP.BASICCONTAINER) {\n                gameItemPredicate = 'ldp:contains';\n              } else {\n                gameItemPredicate = 'schema:hasPart';\n              } // Collect the items into an array so we can validate the list of IRIs\n\n\n              gameUrls = [];\n              _iteratorNormalCompletion = true;\n              _didIteratorError = false;\n              _context5.prev = 15;\n              _iterator = _asyncIterator(document[gameItemPredicate]);\n\n            case 17:\n              _context5.next = 19;\n              return _iterator.next();\n\n            case 19:\n              _step = _context5.sent;\n              _iteratorNormalCompletion = _step.done;\n              _context5.next = 23;\n              return _step.value;\n\n            case 23:\n              _value = _context5.sent;\n\n              if (_iteratorNormalCompletion) {\n                _context5.next = 31;\n                break;\n              }\n\n              item = _value;\n              value = item.value;\n              gameUrls.push(value);\n\n            case 28:\n              _iteratorNormalCompletion = true;\n              _context5.next = 17;\n              break;\n\n            case 31:\n              _context5.next = 37;\n              break;\n\n            case 33:\n              _context5.prev = 33;\n              _context5.t0 = _context5[\"catch\"](15);\n              _didIteratorError = true;\n              _iteratorError = _context5.t0;\n\n            case 37:\n              _context5.prev = 37;\n              _context5.prev = 38;\n\n              if (!(!_iteratorNormalCompletion && _iterator.return != null)) {\n                _context5.next = 42;\n                break;\n              }\n\n              _context5.next = 42;\n              return _iterator.return();\n\n            case 42:\n              _context5.prev = 42;\n\n              if (!_didIteratorError) {\n                _context5.next = 45;\n                break;\n              }\n\n              throw _iteratorError;\n\n            case 45:\n              return _context5.finish(42);\n\n            case 46:\n              return _context5.finish(37);\n\n            case 47:\n              if (!(gameUrls.length === 0)) {\n                _context5.next = 49;\n                break;\n              }\n\n              return _context5.abrupt(\"return\", gameUrls);\n\n            case 49:\n              // Run the list of games fetched from the document through the shex validator helper function and store the valid items in gameList\n              gameShapeUrl = 'https://solidsdk.inrupt.net/sdk/tictactoe.shex';\n              _context5.next = 52;\n              return shexUtil.validateList(gameUrls, gameShapeUrl);\n\n            case 52:\n              gameList = _context5.sent;\n              games = []; // Looping over all valid game data\n\n              _iteratorNormalCompletion2 = true;\n              _didIteratorError2 = false;\n              _context5.prev = 56;\n              _iterator2 = _asyncIterator(gameList);\n\n            case 58:\n              _context5.next = 60;\n              return _iterator2.next();\n\n            case 60:\n              _step2 = _context5.sent;\n              _iteratorNormalCompletion2 = _step2.done;\n              _context5.next = 64;\n              return _step2.value;\n\n            case 64:\n              _value2 = _context5.sent;\n\n              if (_iteratorNormalCompletion2) {\n                _context5.next = 81;\n                break;\n              }\n\n              game = _value2;\n              gameData = {}; // Looping over each predicate in the game shape\n\n              _iterator3 = _createForOfIteratorHelper(tictactoeShape.shape);\n\n              try {\n                _loop = function _loop() {\n                  var _objectSpread2;\n\n                  var field = _step3.value;\n                  var predicate = getPredicate(field); // Find the quad that matches this field, and get the value\n\n                  var fieldQuad = game.find(function (obj) {\n                    return obj.predicate.value === predicate;\n                  });\n                  var fieldValue = fieldQuad.object.value;\n                  gameData = _objectSpread({}, gameData, (_objectSpread2 = {\n                    url: fieldQuad.subject.value\n                  }, _defineProperty(_objectSpread2, field.predicate, fieldValue), _defineProperty(_objectSpread2, \"deleted\", false), _defineProperty(_objectSpread2, \"documentUrl\", url), _objectSpread2));\n                };\n\n                for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {\n                  _loop();\n                } // Only the IRI of the opponent and player are stored in the shape\n                // This fetches the name and image, and stores it as an object\n\n              } catch (err) {\n                _iterator3.e(err);\n              } finally {\n                _iterator3.f();\n              }\n\n              _context5.next = 72;\n              return getPlayerInfo(gameData.opponent);\n\n            case 72:\n              opponent = _context5.sent;\n              _context5.next = 75;\n              return getPlayerInfo(gameData.actor);\n\n            case 75:\n              actor = _context5.sent;\n              gameData = _objectSpread({}, gameData, {\n                actor: actor,\n                opponent: opponent\n              });\n              games = [].concat(_toConsumableArray(games), [gameData]);\n\n            case 78:\n              _iteratorNormalCompletion2 = true;\n              _context5.next = 58;\n              break;\n\n            case 81:\n              _context5.next = 87;\n              break;\n\n            case 83:\n              _context5.prev = 83;\n              _context5.t1 = _context5[\"catch\"](56);\n              _didIteratorError2 = true;\n              _iteratorError2 = _context5.t1;\n\n            case 87:\n              _context5.prev = 87;\n              _context5.prev = 88;\n\n              if (!(!_iteratorNormalCompletion2 && _iterator2.return != null)) {\n                _context5.next = 92;\n                break;\n              }\n\n              _context5.next = 92;\n              return _iterator2.return();\n\n            case 92:\n              _context5.prev = 92;\n\n              if (!_didIteratorError2) {\n                _context5.next = 95;\n                break;\n              }\n\n              throw _iteratorError2;\n\n            case 95:\n              return _context5.finish(92);\n\n            case 96:\n              return _context5.finish(87);\n\n            case 97:\n              return _context5.abrupt(\"return\", games);\n\n            case 100:\n              _context5.prev = 100;\n              _context5.t2 = _context5[\"catch\"](0);\n              errorToaster(_context5.t2.message, 'Error');\n\n            case 103:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, _callee5, null, [[0, 100], [15, 33, 37, 47], [38,, 42, 46], [56, 83, 87, 97], [88,, 92, 96]]);\n    }));\n\n    return function (_x6) {\n      return _ref8.apply(this, arguments);\n    };\n  }(), [gamePath]);\n  /**\n   * Inits the game by fetching own games and games the player has been invited to\n   */\n\n  var init = useCallback( /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee6() {\n    var inviteGamesUrl, games, inviteGames, allGames;\n    return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n      while (1) {\n        switch (_context6.prev = _context6.next) {\n          case 0:\n            setIsLoading(true);\n            _context6.next = 3;\n            return storageHelper.getAppStorage(webId);\n\n          case 3:\n            appPath = _context6.sent;\n            inviteGamesUrl = \"\".concat(appPath, \"data.ttl\");\n            _context6.next = 7;\n            return getGames(gamePath);\n\n          case 7:\n            games = _context6.sent;\n            _context6.next = 10;\n            return getGames(inviteGamesUrl);\n\n          case 10:\n            inviteGames = _context6.sent;\n            allGames = [];\n            if (Array.isArray(games)) allGames = [].concat(_toConsumableArray(allGames), _toConsumableArray(games));\n            if (Array.isArray(inviteGames)) allGames = [].concat(_toConsumableArray(allGames), _toConsumableArray(inviteGames));\n            setList(allGames);\n            setIsLoading(false);\n\n          case 16:\n          case \"end\":\n            return _context6.stop();\n        }\n      }\n    }, _callee6);\n  })));\n  useEffect(function () {\n    if (gamePath) init();\n  }, [gamePath]);\n  useEffect(function () {\n    var currentTimestamp = timestamp && timestamp.toString();\n\n    if (timestamp && currentTimestamp !== oldTimestamp) {\n      init();\n      oldTimestamp = currentTimestamp;\n    }\n  }, [timestamp]);\n  return /*#__PURE__*/React.createElement(Wrapper, {\n    \"data-testid\": \"game-list\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 298,\n      columnNumber: 5\n    }\n  }, !isLoading ? /*#__PURE__*/React.createElement(GameListContainers, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 300,\n      columnNumber: 9\n    }\n  }, list && /*#__PURE__*/React.createElement(GameList, {\n    title: t('game.yourGames'),\n    games: list,\n    webId: webId,\n    deleteGame: deleteGame,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 302,\n      columnNumber: 13\n    }\n  })) : /*#__PURE__*/React.createElement(Loader, {\n    absolute: true,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 311,\n      columnNumber: 9\n    }\n  }));\n};\n\nexport default List;","map":{"version":3,"sources":["D:/Downloads/Test HTML/testgenerator/Test_app/src/containers/TicTacToe/GameListPage/children/List/list.component.js"],"names":["React","useState","useEffect","useCallback","useLiveUpdate","NotificationTypes","shexUtil","useTranslation","ldflex","namedNode","Loader","Select","tictactoeShape","ldflexHelper","errorToaster","storageHelper","notification","helperNotification","GameStatusList","GameStatus","KnownInboxes","LDP","Wrapper","ListWrapper","GameListContainers","GameListHeader","GameItem","oldTimestamp","appPath","GameList","title","games","webId","deleteGame","t","filteredGames","setFilteredGames","selectedFilter","setSelectedFilter","filterGameList","event","filter","target","value","ALL","filteredList","game","status","length","map","url","List","gamePath","sendNotification","list","setList","isLoading","setIsLoading","updates","timestamp","getPredicate","field","prefix","predicate","deleteGameFromContains","gameUrl","documentUrl","delete","resignedGame","actor","FINISHED","statusPredicate","licenseUrl","replace","RESIGNED","getAppStorage","gameSettings","GLOBAL","GAME","findUserInboxes","path","name","inboxes","to","getDefaultInbox","summary","object","LEAVE","deleted","opponent","deleteFile","newGames","gameItem","getPlayerInfo","nameValue","trim","toString","imageUrl","image","getGames","fetchLdflexDocument","document","gameList","type","typeValue","undefined","BASICCONTAINER","gameItemPredicate","gameUrls","item","push","gameShapeUrl","validateList","gameData","shape","fieldQuad","find","obj","fieldValue","subject","message","init","inviteGamesUrl","inviteGames","allGames","Array","isArray","currentTimestamp"],"mappings":";;;;;;;;;;;;;;;;;AAAA,OAAOA,KAAP,IAAgBC,QAAhB,EAA0BC,SAA1B,EAAqCC,WAArC,QAAwD,OAAxD;AACA,SAASC,aAAT,EAAwBC,iBAAxB,EAA2CC,QAA3C,QAA2D,gCAA3D;AACA,SAASC,cAAT,QAA+B,eAA/B;AACA,OAAOC,MAAP,MAAmB,qBAAnB;AACA,SAASC,SAAT,QAA0B,mBAA1B;AACA,SAASC,MAAT,EAAiBC,MAAjB;AACA,OAAOC,cAAP;AACA,SACEC,YADF,EAEEC,YAFF,EAGEC,aAHF,EAIEC,YAAY,IAAIC,kBAJlB;AAMA,SAASC,cAAT,EAAyBC,UAAzB,EAAqCC,YAArC;AACA,SAASC,GAAT;AACA,SAASC,OAAT,EAAkBC,WAAlB,EAA+BC,kBAA/B,EAAmDC,cAAnD;AACA,OAAOC,QAAP;AAEA,IAAIC,YAAJ;AACA,IAAIC,OAAJ;;AAKA;;;;;;;;AAQA,IAAMC,QAAQ,GAAG,SAAXA,QAAW,OAAwD;AAAA,MAArDC,KAAqD,QAArDA,KAAqD;AAAA,MAA9CC,KAA8C,QAA9CA,KAA8C;AAAA,MAAvCC,KAAuC,QAAvCA,KAAuC;AAAA,MAAhCC,UAAgC,QAAhCA,UAAgC;;AAAA,wBACzD1B,cAAc,EAD2C;AAAA,MAC/D2B,CAD+D,mBAC/DA,CAD+D;;AAAA,kBAE7BjC,QAAQ,CAAC8B,KAAD,CAFqB;AAAA;AAAA,MAEhEI,aAFgE;AAAA,MAEjDC,gBAFiD;;AAAA,mBAG3BnC,QAAQ,CAAC,KAAD,CAHmB;AAAA;AAAA,MAGhEoC,cAHgE;AAAA,MAGhDC,iBAHgD;AAKvE;;;;;;AAIA,MAAMC,cAAc,GAAG,SAAjBA,cAAiB,CAAAC,KAAK,EAAI;AAC9B,QAAMC,MAAM,GAAGD,KAAK,CAACE,MAAN,CAAaC,KAA5B;;AACA,QAAIF,MAAM,KAAKtB,UAAU,CAACyB,GAA1B,EAA+B;AAC7BR,MAAAA,gBAAgB,CAACL,KAAD,CAAhB;AACD,KAFD,MAEO;AACL,UAAMc,YAAY,GAAGd,KAAK,CAACU,MAAN,CAAa,UAAAK,IAAI;AAAA,eAAIA,IAAI,CAACC,MAAL,KAAgBN,MAApB;AAAA,OAAjB,CAArB;AACAL,MAAAA,gBAAgB,CAACS,YAAD,CAAhB;AACD;;AACDP,IAAAA,iBAAiB,CAACG,MAAD,CAAjB;AACD,GATD;;AAWA,sBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACE,oBAAC,cAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAKX,KAAL,CADF,eAEE;AAAK,IAAA,SAAS,EAAC,YAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACE;AAAO,IAAA,OAAO,EAAC,iBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACGI,CAAC,CAAC,aAAD,CADJ,eAEE,oBAAC,MAAD;AACE,IAAA,IAAI,EAAC,iBADP;AAEE,IAAA,EAAE,EAAC,iBAFL;AAGE,IAAA,OAAO,EAAEhB,cAHX;AAIE,IAAA,YAAY,EAAEmB,cAJhB;AAKE,IAAA,QAAQ,EAAEE,cALZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAFF,CADF,CAFF,CADF,EAgBGJ,aAAa,CAACa,MAAd,GAAuB,CAAvB,gBACC,oBAAC,WAAD;AAAa,IAAA,SAAS,EAAC,iCAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACGb,aAAa,CAACc,GAAd,CAAkB,UAAAH,IAAI;AAAA,wBACrB,oBAAC,QAAD,gBAAc;AAAEA,MAAAA,IAAI,EAAJA;AAAF,KAAd;AAAwB,MAAA,GAAG,EAAEA,IAAI,CAACI,GAAlC;AAAuC,MAAA,KAAK,EAAElB,KAA9C;AAAqD,MAAA,UAAU,EAAEC,UAAjE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OADqB;AAAA,GAAtB,CADH,CADD,gBAOC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAOC,CAAC,CAAC,cAAD,CAAR,CAvBJ,CADF;AA4BD,CAhDD;;AAkDA,IAAMiB,IAAI,GAAG,SAAPA,IAAO,QAAkD;AAAA,MAA/CnB,KAA+C,SAA/CA,KAA+C;AAAA,MAAxCoB,QAAwC,SAAxCA,QAAwC;AAAA,MAA9BC,gBAA8B,SAA9BA,gBAA8B;;AAAA,mBACrCpD,QAAQ,CAAC,EAAD,CAD6B;AAAA;AAAA,MACtDqD,IADsD;AAAA,MAChDC,OADgD;;AAAA,mBAE3BtD,QAAQ,CAAC,KAAD,CAFmB;AAAA;AAAA,MAEtDuD,SAFsD;AAAA,MAE3CC,YAF2C;;AAAA,yBAG/ClD,cAAc,EAHiC;AAAA,MAGrD2B,CAHqD,oBAGrDA,CAHqD;;AAI7D,MAAMwB,OAAO,GAAGtD,aAAa,EAA7B;AAJ6D,MAKrDuD,SALqD,GAKvCD,OALuC,CAKrDC,SALqD;AAO7D;;;;;;AAKA,MAAMC,YAAY,GAAG,SAAfA,YAAe,CAAAC,KAAK,EAAI;AAC5B,QAAMC,MAAM,GAAGlD,cAAc,CAAC,UAAD,CAAd,CAA2BiD,KAAK,CAACC,MAAjC,CAAf;AACA,qBAAUA,MAAV,SAAmBD,KAAK,CAACE,SAAzB;AACD,GAHD;AAKA;;;;;;;AAKA,MAAMC,sBAAsB;AAAA,yEAAG,iBAAOC,OAAP,EAAgBC,WAAhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBACvB1D,MAAM,CAAC0D,WAAD,CAAN,CAAoB,gBAApB,EAAsCC,MAAtC,CAA6C1D,SAAS,CAACwD,OAAD,CAAtD,CADuB;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAH;;AAAA,oBAAtBD,sBAAsB;AAAA;AAAA;AAAA,KAA5B;AAIA;;;;;;AAIA,MAAMI,YAAY;AAAA,yEAAG;AAAA;AAAA;AAAA;AAAA;AAAA;AAASlB,cAAAA,GAAT,SAASA,GAAT,EAAcgB,WAAd,SAAcA,WAAd,EAA2BnB,MAA3B,SAA2BA,MAA3B,EAAmCsB,KAAnC,SAAmCA,KAAnC;;AAAA,oBACftB,MAAM,KAAK5B,UAAU,CAACmD,QADP;AAAA;AAAA;AAAA;;AAEXC,cAAAA,eAFW,GAEO,kCAFP;AAGXC,cAAAA,UAHW,GAGE,iDAHF,EAIjB;;AAJiB;AAAA,qBAKXhE,MAAM,CAAC0C,GAAD,CAAN,CAAYqB,eAAZ,EAA6BE,OAA7B,CAAqC1B,MAArC,EAA6C5B,UAAU,CAACuD,QAAxD,CALW;;AAAA;AAAA,kBAOZ9C,OAPY;AAAA;AAAA;AAAA;;AAAA;AAAA,qBAQCb,aAAa,CAAC4D,aAAd,CAA4BN,KAAK,CAACrC,KAAlC,CARD;;AAAA;AAQfJ,cAAAA,OARe;;AAAA;AAWjB;AACMgD,cAAAA,YAZW,aAYOhD,OAZP;AAaTiD,cAAAA,MAbS,GAaQzD,YAbR,CAaTyD,MAbS,EAaDC,IAbC,GAaQ1D,YAbR,CAaD0D,IAbC;AAAA;AAAA,qBAeK7D,kBAAkB,CAAC8D,eAAnB,CAAmC,CACvD;AAAEC,gBAAAA,IAAI,EAAEX,KAAK,CAACrC,KAAd;AAAqBiD,gBAAAA,IAAI,EAAEJ;AAA3B,eADuD,EAEvD;AAAEG,gBAAAA,IAAI,EAAEJ,YAAR;AAAsBK,gBAAAA,IAAI,EAAEH;AAA5B,eAFuD,CAAnC,CAfL;;AAAA;AAeXI,cAAAA,OAfW;AAoBXC,cAAAA,EApBW,GAoBNlE,kBAAkB,CAACmE,eAAnB,CAAmCF,OAAnC,EAA4CJ,IAA5C,EAAkDD,MAAlD,CApBM;AAAA;AAAA,qBAsBXxB,gBAAgB,CACpB;AACEvB,gBAAAA,KAAK,EAAE,uBADT;AAEEuD,gBAAAA,OAAO,EAAE,kCAFX;AAGEhB,gBAAAA,KAAK,EAAErC,KAHT;AAIEsD,gBAAAA,MAAM,EAAEpC;AAJV,eADoB,EAOpBiC,EAAE,CAACH,IAPiB,EAQpB3E,iBAAiB,CAACkF,KARE,EASpBf,UAToB,CAtBL;;AAAA;AAAA;AAAA,qBAmCbR,sBAAsB,CAACd,GAAD,EAAMgB,WAAN,CAnCT;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAH;;AAAA,oBAAZE,YAAY;AAAA;AAAA;AAAA,KAAlB;AAsCA;;;;;;;AAKA,MAAMnC,UAAU;AAAA,yEAAG,kBAAMa,IAAN;AAAA;AAAA;AAAA;AAAA;AAAA;AACTI,cAAAA,GADS,GAC+BJ,IAD/B,CACTI,GADS,EACJsC,OADI,GAC+B1C,IAD/B,CACJ0C,OADI,EACKtB,WADL,GAC+BpB,IAD/B,CACKoB,WADL,EACkBuB,QADlB,GAC+B3C,IAD/B,CACkB2C,QADlB;;AAAA,mBAEbD,OAFa;AAAA;AAAA;AAAA;;AAAA;AAAA,qBAGTxB,sBAAsB,CAACd,GAAD,EAAMgB,WAAN,CAHb;;AAAA;AAAA;AAAA;;AAAA;AAAA,oBAINuB,QAAQ,CAACzD,KAAT,KAAmBA,KAJb;AAAA;AAAA;AAAA;;AAAA;AAAA,qBAI0BoC,YAAY,CAACtB,IAAD,CAJtC;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA,qBAKNjC,YAAY,CAAC6E,UAAb,CAAwBxC,GAAxB,CALM;;AAAA;AAOXyC,cAAAA,QAPW,GAOArC,IAAI,CAACb,MAAL,CAAY,UAAAmD,QAAQ;AAAA,uBAAIA,QAAQ,CAAC1C,GAAT,KAAiBA,GAArB;AAAA,eAApB,CAPA;AAQjBK,cAAAA,OAAO,CAACoC,QAAD,CAAP;;AARiB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAH;;AAAA,oBAAV1D,UAAU;AAAA;AAAA;AAAA,KAAhB;AAWA;;;;;;;AAKA,MAAM4D,aAAa,GAAG1F,WAAW;AAAA,yEAAC,kBAAM6B,KAAN;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBAEXxB,MAAM,CAACwB,KAAD,CAAN,CAAc,UAAd,CAFW;;AAAA;AAExBiD,cAAAA,IAFwB;AAGxBa,cAAAA,SAHwB,GAGZb,IAAI,IAAIA,IAAI,CAACtC,KAAL,CAAWoD,IAAX,GAAkB/C,MAAlB,GAA2B,CAAnC,GAAuCiC,IAAI,CAACtC,KAA5C,GAAoDX,KAAK,CAACgE,QAAN,EAHxC;AAAA;AAAA,qBAIPxF,MAAM,CAACwB,KAAD,CAAN,CAAc,gBAAd,CAJO;;AAAA;AAIxBiE,cAAAA,QAJwB;AAKxBC,cAAAA,KALwB,GAKhBD,QAAQ,GAAGA,QAAQ,CAACtD,KAAZ,GAAoB,gBALZ;AAAA,gDAMvB;AAAEsC,gBAAAA,IAAI,EAAEa,SAAR;AAAmBI,gBAAAA,KAAK,EAALA,KAAnB;AAA0BlE,gBAAAA,KAAK,EAALA;AAA1B,eANuB;;AAAA;AAAA;AAAA;AAAA,gDAQvB;AAAEiD,gBAAAA,IAAI,EAAEjD,KAAR;AAAekE,gBAAAA,KAAK,EAAE,gBAAtB;AAAwClE,gBAAAA,KAAK,EAALA;AAAxC,eARuB;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAD;;AAAA;AAAA;AAAA;AAAA,MAAjC;AAYA;;;;;AAIA,MAAMmE,QAAQ,GAAGhG,WAAW;AAAA,yEAC1B,kBAAM+C,GAAN;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBAG2BrC,YAAY,CAACuF,mBAAb,CAAiClD,GAAjC,CAH3B;;AAAA;AAGUmD,cAAAA,QAHV;AAIQC,cAAAA,QAJR,GAImB,EAJnB;;AAAA,kBAKSD,QALT;AAAA;AAAA;AAAA;;AAAA,gDAK0BC,QAL1B;;AAAA;AAAA;AAAA,qBAOuBD,QAAQ,CAAC,UAAD,CAP/B;;AAAA;AAOUE,cAAAA,IAPV;AAQUC,cAAAA,SARV,GAQsBD,IAAI,GAAGA,IAAI,CAAC5D,KAAR,GAAgB8D,SAR1C;AAUI;;;;;;AAKA,kBAAID,SAAS,KAAKnF,GAAG,CAACqF,cAAtB,EAAsC;AACpCC,gBAAAA,iBAAiB,GAAG,cAApB;AACD,eAFD,MAEO;AACLA,gBAAAA,iBAAiB,GAAG,gBAApB;AACD,eAnBL,CAqBI;;;AACMC,cAAAA,QAtBV,GAsBqB,EAtBrB;AAAA;AAAA;AAAA;AAAA,yCAuB6BP,QAAQ,CAACM,iBAAD,CAvBrC;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAuBqBE,cAAAA,IAvBrB;AAwBclE,cAAAA,KAxBd,GAwBwBkE,IAxBxB,CAwBclE,KAxBd;AAyBMiE,cAAAA,QAAQ,CAACE,IAAT,CAAcnE,KAAd;;AAzBN;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA,oBA4BQiE,QAAQ,CAAC5D,MAAT,KAAoB,CA5B5B;AAAA;AAAA;AAAA;;AAAA,gDA6Ba4D,QA7Bb;;AAAA;AAgCI;AACMG,cAAAA,YAjCV,GAiCyB,gDAjCzB;AAAA;AAAA,qBAkCqBzG,QAAQ,CAAC0G,YAAT,CAAsBJ,QAAtB,EAAgCG,YAAhC,CAlCrB;;AAAA;AAkCIT,cAAAA,QAlCJ;AAoCQvE,cAAAA,KApCR,GAoCgB,EApChB,EAsCI;;AAtCJ;AAAA;AAAA;AAAA,0CAuC6BuE,QAvC7B;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAuCqBxD,cAAAA,IAvCrB;AAwCUmE,cAAAA,QAxCV,GAwCqB,EAxCrB,EA0CM;;AA1CN,sDA2C0BrG,cAAc,CAACsG,KA3CzC;;AAAA;AAAA;AAAA;;AAAA,sBA2CiBrD,KA3CjB;AA4CQ,sBAAME,SAAS,GAAGH,YAAY,CAACC,KAAD,CAA9B,CA5CR,CA8CQ;;AACA,sBAAMsD,SAAS,GAAGrE,IAAI,CAACsE,IAAL,CAAU,UAAAC,GAAG;AAAA,2BAAIA,GAAG,CAACtD,SAAJ,CAAcpB,KAAd,KAAwBoB,SAA5B;AAAA,mBAAb,CAAlB;AACA,sBAAMuD,UAAU,GAAGH,SAAS,CAAC7B,MAAV,CAAiB3C,KAApC;AAEAsE,kBAAAA,QAAQ,qBACHA,QADG;AAEN/D,oBAAAA,GAAG,EAAEiE,SAAS,CAACI,OAAV,CAAkB5E;AAFjB,qDAGLkB,KAAK,CAACE,SAHD,EAGauD,UAHb,8CAIG,KAJH,kDAKOpE,GALP,mBAAR;AAlDR;;AA2CM,uEAA0C;AAAA;AAczC,iBAzDP,CA2DM;AACA;;AA5DN;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA,qBA6D6B2C,aAAa,CAACoB,QAAQ,CAACxB,QAAV,CA7D1C;;AAAA;AA6DYA,cAAAA,QA7DZ;AAAA;AAAA,qBA8D0BI,aAAa,CAACoB,QAAQ,CAAC5C,KAAV,CA9DvC;;AAAA;AA8DYA,cAAAA,KA9DZ;AAgEM4C,cAAAA,QAAQ,qBAAQA,QAAR;AAAkB5C,gBAAAA,KAAK,EAALA,KAAlB;AAAyBoB,gBAAAA,QAAQ,EAARA;AAAzB,gBAAR;AAEA1D,cAAAA,KAAK,gCAAOA,KAAP,IAAckF,QAAd,EAAL;;AAlEN;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA,gDAoEWlF,KApEX;;AAAA;AAAA;AAAA;AAsEIjB,cAAAA,YAAY,CAAC,aAAE0G,OAAH,EAAY,OAAZ,CAAZ;;AAtEJ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAD0B;;AAAA;AAAA;AAAA;AAAA,OA0E1B,CAACpE,QAAD,CA1E0B,CAA5B;AA6EA;;;;AAGA,MAAMqE,IAAI,GAAGtH,WAAW,wEAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AACvBsD,YAAAA,YAAY,CAAC,IAAD,CAAZ;AADuB;AAAA,mBAEP1C,aAAa,CAAC4D,aAAd,CAA4B3C,KAA5B,CAFO;;AAAA;AAEvBJ,YAAAA,OAFuB;AAIjB8F,YAAAA,cAJiB,aAIG9F,OAJH;AAAA;AAAA,mBAKHuE,QAAQ,CAAC/C,QAAD,CALL;;AAAA;AAKjBrB,YAAAA,KALiB;AAAA;AAAA,mBAMGoE,QAAQ,CAACuB,cAAD,CANX;;AAAA;AAMjBC,YAAAA,WANiB;AAQnBC,YAAAA,QARmB,GAQR,EARQ;AAUvB,gBAAIC,KAAK,CAACC,OAAN,CAAc/F,KAAd,CAAJ,EAA0B6F,QAAQ,gCAAOA,QAAP,sBAAoB7F,KAApB,EAAR;AAE1B,gBAAI8F,KAAK,CAACC,OAAN,CAAcH,WAAd,CAAJ,EAAgCC,QAAQ,gCAAOA,QAAP,sBAAoBD,WAApB,EAAR;AAChCpE,YAAAA,OAAO,CAACqE,QAAD,CAAP;AACAnE,YAAAA,YAAY,CAAC,KAAD,CAAZ;;AAduB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAD,GAAxB;AAiBAvD,EAAAA,SAAS,CAAC,YAAM;AACd,QAAIkD,QAAJ,EAAcqE,IAAI;AACnB,GAFQ,EAEN,CAACrE,QAAD,CAFM,CAAT;AAIAlD,EAAAA,SAAS,CAAC,YAAM;AACd,QAAM6H,gBAAgB,GAAGpE,SAAS,IAAIA,SAAS,CAACqC,QAAV,EAAtC;;AACA,QAAIrC,SAAS,IAAIoE,gBAAgB,KAAKpG,YAAtC,EAAoD;AAClD8F,MAAAA,IAAI;AACJ9F,MAAAA,YAAY,GAAGoG,gBAAf;AACD;AACF,GANQ,EAMN,CAACpE,SAAD,CANM,CAAT;AAQA,sBACE,oBAAC,OAAD;AAAS,mBAAY,WAArB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACG,CAACH,SAAD,gBACC,oBAAC,kBAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACGF,IAAI,iBACH,oBAAC,QAAD;AACE,IAAA,KAAK,EAAEpB,CAAC,CAAC,gBAAD,CADV;AAEE,IAAA,KAAK,EAAEoB,IAFT;AAGE,IAAA,KAAK,EAAEtB,KAHT;AAIE,IAAA,UAAU,EAAEC,UAJd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAFJ,CADD,gBAYC,oBAAC,MAAD;AAAQ,IAAA,QAAQ,MAAhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAbJ,CADF;AAkBD,CAxOD;;AA0OA,eAAekB,IAAf","sourcesContent":["import React, { useState, useEffect, useCallback } from 'react';\nimport { useLiveUpdate, NotificationTypes, shexUtil } from '@inrupt/solid-react-components';\nimport { useTranslation } from 'react-i18next';\nimport ldflex from '@solid/query-ldflex';\nimport { namedNode } from '@rdfjs/data-model';\nimport { Loader, Select } from '@util-components';\nimport tictactoeShape from '@contexts/tictactoe-shape.json';\nimport {\n  ldflexHelper,\n  errorToaster,\n  storageHelper,\n  notification as helperNotification\n} from '@utils';\nimport { GameStatusList, GameStatus, KnownInboxes } from '@constants';\nimport { LDP } from '@vocabs';\nimport { Wrapper, ListWrapper, GameListContainers, GameListHeader } from './list.style';\nimport GameItem from './children';\n\nlet oldTimestamp;\nlet appPath;\n\ntype Props = { webId: String, gamePath: String, sendNotification: Function };\ntype GameListProps = { title: String, games: Array, webId: String, deleteGame: Function };\n\n/**\n * Loads, filters, and displays the list of available games for the current user\n *\n * @param {String} title - Title of the list to display\n * @param {Array} games - A list of all of the games available to the user\n * @param {String} webId - WebID URL of the current user\n * @param {Function} deleteGame - A reference to the delete game function\n */\nconst GameList = ({ title, games, webId, deleteGame }: GameListProps) => {\n  const { t } = useTranslation();\n  const [filteredGames, setFilteredGames] = useState(games);\n  const [selectedFilter, setSelectedFilter] = useState('All');\n\n  /**\n   * Set the visible game list depending on what filter the user has selected\n   * @param event\n   */\n  const filterGameList = event => {\n    const filter = event.target.value;\n    if (filter === GameStatus.ALL) {\n      setFilteredGames(games);\n    } else {\n      const filteredList = games.filter(game => game.status === filter);\n      setFilteredGames(filteredList);\n    }\n    setSelectedFilter(filter);\n  };\n\n  return (\n    <div>\n      <GameListHeader>\n        <h2>{title}</h2>\n        <div className=\"input-wrap\">\n          <label htmlFor=\"selected-filter\">\n            {t('game.status')}\n            <Select\n              name=\"selected-filter\"\n              id=\"selected-filter\"\n              options={GameStatusList}\n              defaultValue={selectedFilter}\n              onChange={filterGameList}\n            />\n          </label>\n        </div>\n      </GameListHeader>\n      {filteredGames.length > 0 ? (\n        <ListWrapper className=\"ids-container__four-column grid\">\n          {filteredGames.map(game => (\n            <GameItem {...{ game }} key={game.url} webId={webId} deleteGame={deleteGame} />\n          ))}\n        </ListWrapper>\n      ) : (\n        <span>{t('game.nogames')}</span>\n      )}\n    </div>\n  );\n};\n\nconst List = ({ webId, gamePath, sendNotification }: Props) => {\n  const [list, setList] = useState([]);\n  const [isLoading, setIsLoading] = useState(false);\n  const { t } = useTranslation();\n  const updates = useLiveUpdate();\n  const { timestamp } = updates;\n\n  /**\n   * Gets the entire predicate named Node based on a field property from the shape\n   * @param {String} field Field to get the predicate for\n   * @returns {String} Predicate for a field name\n   */\n  const getPredicate = field => {\n    const prefix = tictactoeShape['@context'][field.prefix];\n    return `${prefix}${field.predicate}`;\n  };\n\n  /**\n   * Deletes a game from a contains predicate in a specific url\n   * @param {String} gameUrl Game to delete\n   * @param {String} documentUrl URL of the document with a contains predicate\n   */\n  const deleteGameFromContains = async (gameUrl, documentUrl) => {\n    await ldflex[documentUrl]['schema:hasPart'].delete(namedNode(gameUrl));\n  };\n\n  /**\n   * Deletes a game as invitee, sets the game status to Resigned and sends a notification to the owner\n   * @param {Object} game Game to be deleted\n   */\n  const resignedGame = async ({ url, documentUrl, status, actor }) => {\n    if (status !== GameStatus.FINISHED) {\n      const statusPredicate = 'http://data.totl.net/game/status';\n      const licenseUrl = 'https://creativecommons.org/licenses/by-sa/4.0/';\n      // Change status to resigned\n      await ldflex[url][statusPredicate].replace(status, GameStatus.RESIGNED);\n\n      if (!appPath) {\n        appPath = await storageHelper.getAppStorage(actor.webId);\n      }\n\n      // Send notification\n      const gameSettings = `${appPath}settings.ttl`;\n      const { GLOBAL, GAME } = KnownInboxes;\n\n      const inboxes = await helperNotification.findUserInboxes([\n        { path: actor.webId, name: GLOBAL },\n        { path: gameSettings, name: GAME }\n      ]);\n\n      const to = helperNotification.getDefaultInbox(inboxes, GAME, GLOBAL);\n\n      await sendNotification(\n        {\n          title: 'Tictactoe resignation',\n          summary: 'has resigned a game of TicTacToe',\n          actor: webId,\n          object: url\n        },\n        to.path,\n        NotificationTypes.LEAVE,\n        licenseUrl\n      );\n    }\n    // Delete game from contains\n    await deleteGameFromContains(url, documentUrl);\n  };\n\n  /**\n   * Deletes a game based on it's url. Checks for a deleted flag\n   * to check if it needs to be deleted from a contains predicate\n   * @param {Object} game Game to be deleted\n   */\n  const deleteGame = async game => {\n    const { url, deleted, documentUrl, opponent } = game;\n    if (deleted) {\n      await deleteGameFromContains(url, documentUrl);\n    } else if (opponent.webId === webId) await resignedGame(game);\n    else await ldflexHelper.deleteFile(url);\n\n    const newGames = list.filter(gameItem => gameItem.url !== url);\n    setList(newGames);\n  };\n\n  /**\n   * Get basic info for the opponent player (name and image url)\n   * @param {String} webId WebId of the player to look the Info for\n   * @returns {Object} An object with the basic information of the player\n   */\n  const getPlayerInfo = useCallback(async webId => {\n    try {\n      const name = await ldflex[webId]['vcard:fn'];\n      const nameValue = name && name.value.trim().length > 0 ? name.value : webId.toString();\n      const imageUrl = await ldflex[webId]['vcard:hasPhoto'];\n      const image = imageUrl ? imageUrl.value : 'img/people.svg';\n      return { name: nameValue, image, webId };\n    } catch (e) {\n      return { name: webId, image: 'img/people.svg', webId };\n    }\n  });\n\n  /**\n   * Fetches all games from a url\n   * @param {String} url URL for the container to get the games from\n   */\n  const getGames = useCallback(\n    async url => {\n      try {\n        let gameItemPredicate;\n        const document = await ldflexHelper.fetchLdflexDocument(url);\n        let gameList = [];\n        if (!document) return gameList;\n\n        const type = await document['rdf:type'];\n        const typeValue = type ? type.value : undefined;\n\n        /**\n         * If the document is a container, then we want to loop over the ldp:contains property of the container\n         * If it is not a container, we are using schema:hasPart so we don't confuse it with a container\n         * schema:hasPart is used for externally linked games in other people's pods\n         */\n        if (typeValue === LDP.BASICCONTAINER) {\n          gameItemPredicate = 'ldp:contains';\n        } else {\n          gameItemPredicate = 'schema:hasPart';\n        }\n\n        // Collect the items into an array so we can validate the list of IRIs\n        const gameUrls = [];\n        for await (const item of document[gameItemPredicate]) {\n          const { value } = item;\n          gameUrls.push(value);\n        }\n\n        if (gameUrls.length === 0) {\n          return gameUrls;\n        }\n\n        // Run the list of games fetched from the document through the shex validator helper function and store the valid items in gameList\n        const gameShapeUrl = 'https://solidsdk.inrupt.net/sdk/tictactoe.shex';\n        gameList = await shexUtil.validateList(gameUrls, gameShapeUrl);\n\n        let games = [];\n\n        // Looping over all valid game data\n        for await (const game of gameList) {\n          let gameData = {};\n\n          // Looping over each predicate in the game shape\n          for (const field of tictactoeShape.shape) {\n            const predicate = getPredicate(field);\n\n            // Find the quad that matches this field, and get the value\n            const fieldQuad = game.find(obj => obj.predicate.value === predicate);\n            const fieldValue = fieldQuad.object.value;\n\n            gameData = {\n              ...gameData,\n              url: fieldQuad.subject.value,\n              [field.predicate]: fieldValue,\n              deleted: false,\n              documentUrl: url\n            };\n          }\n\n          // Only the IRI of the opponent and player are stored in the shape\n          // This fetches the name and image, and stores it as an object\n          const opponent = await getPlayerInfo(gameData.opponent);\n          const actor = await getPlayerInfo(gameData.actor);\n\n          gameData = { ...gameData, actor, opponent };\n\n          games = [...games, gameData];\n        }\n        return games;\n      } catch (e) {\n        errorToaster(e.message, 'Error');\n      }\n    },\n    [gamePath]\n  );\n\n  /**\n   * Inits the game by fetching own games and games the player has been invited to\n   */\n  const init = useCallback(async () => {\n    setIsLoading(true);\n    appPath = await storageHelper.getAppStorage(webId);\n\n    const inviteGamesUrl = `${appPath}data.ttl`;\n    const games = await getGames(gamePath);\n    const inviteGames = await getGames(inviteGamesUrl);\n\n    let allGames = [];\n\n    if (Array.isArray(games)) allGames = [...allGames, ...games];\n\n    if (Array.isArray(inviteGames)) allGames = [...allGames, ...inviteGames];\n    setList(allGames);\n    setIsLoading(false);\n  });\n\n  useEffect(() => {\n    if (gamePath) init();\n  }, [gamePath]);\n\n  useEffect(() => {\n    const currentTimestamp = timestamp && timestamp.toString();\n    if (timestamp && currentTimestamp !== oldTimestamp) {\n      init();\n      oldTimestamp = currentTimestamp;\n    }\n  }, [timestamp]);\n\n  return (\n    <Wrapper data-testid=\"game-list\">\n      {!isLoading ? (\n        <GameListContainers>\n          {list && (\n            <GameList\n              title={t('game.yourGames')}\n              games={list}\n              webId={webId}\n              deleteGame={deleteGame}\n            />\n          )}\n        </GameListContainers>\n      ) : (\n        <Loader absolute />\n      )}\n    </Wrapper>\n  );\n};\n\nexport default List;\n"]},"metadata":{},"sourceType":"module"}